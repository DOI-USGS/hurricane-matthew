vizlab: "0.1.4"
info:
  id: hurricane-matthew
  name: A look at Hurricane Matthew
  date: 2016-10-06
  path: /hurricane-matthew
  analytics-id: UA-78530187-4
  description: >-
    Bringing together a couple different sources of data
    to look at the effects of Hurricane Matthew on the
    Southeast United States Coast.
  keywords: >-
    water, hurricane, matthew, USGS, NOAA, VIZLAB
  thumbnail:    
    url: !NEED TO MAKE THIS THUMBNAIL!
    width: 250
    height: 250
    alttext: Hurricane Matthew
fetch:
  -
    id: counties
    location: cache/counties.zip
    reader: shp
    fetcher: counties
    scripts: scripts/fetch/fetch.counties.R
    refetch: false
    mimetype: application/zip
  -
    id: states
    location: cache/states.zip
    reader: shp
    fetcher: states
    scripts: scripts/fetch/fetch.counties.R
    refetch: false
    mimetype: application/zip
  -
    id: matthew-track
    location: cache/matthew.zip
    ocean: al
    stormnum: 14
    year: 2016
    reader: shp
    fetcher: hurricaneTrack
    scripts: scripts/fetch/hurricaneTrack.R
    mimetype: application/zip
    metadata: "Updates every 6 hours on http://www.nhc.noaa.gov/gis/"
    comment: disabling refetch until timestamp is hooked up
  -
    id: flowlines
    fetcher: flowlines
    scripts: scripts/fetch/fetch.flowlines.R
    location: cache/nhdflowline_network.zip
    mapRange: [-100, -75.432129, 24.994771,40]
    streamorder: 6
    reader: shp
    mimetype: application/zip
    refetch: false
    comment: disabling refetch for now, delete cache to update
  -
    id: precip-data
    fetcher: precip
    scripts: scripts/fetch/fetchPrecip.R
    location: cache/precip.csv
    mimetype: text/csv
    refetch: true
    comment: disabling refetch to avoid too many GDP requests
  -
    id: discharge-data
    fetcher: discharge
    location: cache/discharge.rds
    scripts: scripts/fetch/fetchDischarge.R
    start.date: "2016-10-5"
    depends: ["sites-data","precip-data"]
    reader: rds
    refetch: true
    comment: disabling refetch for now, re-enable to get updates to work
  -
    id: sites-data
    fetcher: sites
    scripts: scripts/fetch/fetch.sites.R
    location: cache/sites.rds
    start.date: "2016-10-5"
    states: ["FL","SC","NC","GA"]
    reader: rds
    refetch: true
    comment: disabling refetch for now, re-enable to get updates to work
  -
    id: stats-data
    fetcher: stats
    scripts: scripts/fetch/fetch.stats.R
    location: cache/stats.rds
    depends: ["sites-data"]
    reader: rds
    refetch: false
    comment: disabling refetch for now, re-enable to get updates to work
process:
  -
    id: matthew-counties
    location: cache/matthew-counties.rds
    processor: matthew_counties
    scripts: scripts/process/process.matthew_counties.R
    reader: rds
    depends: "counties"
  -
    id: matthew-states
    location: cache/matthew-states.rds
    processor: matthew_states
    scripts: scripts/process/process.matthew_counties.R
    reader: rds
    depends: "states"
  -
    id: matthew-flowlines
    location: cache/matthew-flowlines.rds
    processor: flowlines
    scripts: scripts/process/process.flowlines.R
    reader: rds
    depends: ["flowlines","matthew-counties"]
  -
    id: storm-track
    location: cache/storm-track.rds
    processor: matthew_track
    scripts: scripts/process/process.matthew_counties.R
    reader: rds
    depends: ["matthew-track", "matthew-counties"]
  -
    id: storm-location
    location: cache/storm-location.rds
    processor: storm_location
    reader: rds
    depends: ["matthew-track", "matthew-counties"]  
  -
    id: precip-colors
    location: cache/precip-colors.json
    processor: precip_colors
    scripts: scripts/process/process.precip_colors.R
    reader: json
    bins: 9
    pallete: "Blues"
    mimetype: application/javascript
    export: true
  -
    id: gage-colors
    location: cache/gage_colors.rds
    processor: gage_colors
    scripts: scripts/process/process.gage_colors.R
    reader: rds
    bins: 6
    pallete: "Reds"
  -
    id: precip-breaks
    location: cache/precip_breaks.rds
    processor: precip_breaks
    scripts: scripts/process/process.classifyBins.R
    reader: rds
    depends: ["precip-colors"]
  - 
    id: classifyBins
    location: cache/precipBinned.rds
    processor: classifyBins
    scripts: scripts/process/process.classifyBins.R
    reader: rds
    depends: ["precip-breaks", "precip-data"]
  - id: discharge-sparks
    location: cache/discharge-sparks.rds
    processor: discharge_sparks
    scripts: scripts/process/process.matthew_counties.R
    reader: rds
    depends: ["discharge-data","timesteps"]
  -
    id: discharge-classify
    location: cache/discharge-classify.rds
    processor: classify
    scripts: scripts/process/classify.R
    reader: rds
    depends: ["discharge-data","stats-data","gage-colors"]
  -
    id: matthew-sites
    location: cache/sites_geo.rds
    processor: matthew_sites
    scripts: scripts/process/process.matthew_counties.R
    reader: rds
    depends: ["sites-data","matthew-counties", "storm-track"]
  -
    id: timesteps
    location: cache/times.json
    processor: timesteps
    scripts: scripts/process/process.matthew_counties.R
    reader: json
    depends: "classifyBins"
    export: true
    mimetype: application/javascript
    comment: "TOTAL HACK, writing into TARGET. How the heck do you get the other json in there?"
    comment-reply: >-
      export true allows it to be exported to target, 
      mimetype javascript is a hack to use a publisher that works, we should be able
      to either add a json publisher or, general data publisher so this ends up in data/times.json.
visualize:
  -
    id: matthew-map
    location: figures/matthew-water.svg
    visualizer: matthew_map
    depends: ["matthew-counties","matthew-flowlines", "matthew-states", "storm-track", "classifyBins", 
      'storm-location',"matthew-sites", "discharge-classify", "precip-colors", "precip-breaks", "discharge-sparks"]
    scripts: scripts/visualize/visualize.matthew_map.R
    mapdata: "matthew-counties"
    mimetype: image/svg+xml
    inline: true
    title: "title..."
    alttext: "alt text..."
    
publish:
  -
    id: map-figure-css
    location: layout/css/map-figure.css
    mimetype: text/css
  - 
    id: header-footer-css
    location: layout/css/header-footer.css
    mimetype: text/css
  -
    id: usgs-logo
    location: images/usgsLogo.png
    mimetype: image/png
    title: "USGS Logo"
    alttext: "USGS Logo"
  -
    id: jquery-js
    location: layout/js/jquery-3.1.1.min.js
    mimetype: application/javascript
  -
    id: animate-js
    location: layout/js/animate.js
    mimetype: application/javascript
  -
    id: matthew-page
    name: index
    template: fullPage
    publisher: page
    depends: ["header-section", "figure-section", "data-sources", "map-figure-css",
      "header-footer-css", "precip-colors", "timesteps", "jquery-js", "animate-js", "svg-css"]
    context:
      resources: ["map-figure-css","header-footer-css", "jquery-js", "animate-js", "svg-css"]
      sections: [ "header-section", "figure-section", "data-sources" ]
  -
    id: figure-section
    template: layout/templates/mapFigure.mustache
    publisher: section
    depends: [ "matthew-map" ]
    context:
      id: map-figure
      figure: matthew-map
      title: Hurricane Matthew’s Impact on River Flow
      line1: >-
        Hurricane Matthew approached the southeastern U.S. coast on October 7, 2016.
        In the map above, the hurricane’s impact on precipitation and streamflow are 
        shown. Discharge (cubic feet per second) 
        at US Geological Survey gaging stations within ~150 km of the storm cone is shown 
        through time (right panel). Gages shown do not include the US Geological Survey 
        Short-Term Network gages deployed to capture more detailed effects of the hurricane (
      SPNLink: "http://stn.wim.usgs.gov/fev/#MatthewOctober2016"
      line2: ). 
  -
    id: header-section
    template: layout/templates/header.mustache
    publisher: section
    depends: ["usgs-logo"]
    context:
      id: header
      title: Hurricane Matthew's Water Footprint
      logo: usgs-logo
      caption: Water impacts from Hurricane Matthew
  -
    id: data-sources
    template: layout/templates/dataSources.mustache
    publisher: section
    context:
      id: dataSources
      title: Data Sources
      line1: "Streamflow: U.S. Geological Survey National Water Information System ("
      waterDataLink: http://waterdata.usgs.gov/nwis
      line2: >-
        ). Time series of discharge at gages within 150 km of the storm cone are shown through time, 
        ordered by latitude and normalized to site-specific maximum discharge observed over the duration of the hurricane. 
      line4: "Precipitation: National Weather Service Environmental Modeling Center National Center for Environmental Prediction Stage IV precipitation analysis ("
      emcLink: http://www.emc.ncep.noaa.gov/mmb/ylin/pcpanl/stage4/
      line5: ), aggregated according to Blodgett (2013, 
      pubsLink: http://pubs.usgs.gov/fs/2013/3035/pdf/fs2013-3035.pdf
      line6: )
      line7: "Storm Track: National Oceanic and Atmospheric Administration National Hurricane Center Preliminary Best Track for Hurricane Matthew ("
      nhcLink: http://www.nhc.noaa.gov/gis/
      line8: )
# Turning off footer, I think this code needs to be checked in
#  -
#    id: footer-section
#    template: footer
#    publisher: footer
#    depends: header-footer-css
#    blogsInFooter: TRUE
#    vizzies:
#      - name: Microplastics in the Great Lakes
#        org: USGS-VIZLAB
#        repo: great-lakes-microplastics
#      - name: Climate Change and Freshwater Fish
#        org: USGS-VIZLAB
#        repo: climate-fish-habitat
#    blogs: 
#      - name: Using the dataRetrieval Stats Service
#        url: https://owi.usgs.gov/blog/stats-service-map/
#        thumbLoc: https://owi.usgs.gov/blog/images/owi-mobile.png
  -
    id: svg-css
    location: layout/css/matthew-svg.css
    mimetype: text/css